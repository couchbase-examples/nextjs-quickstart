= Quickstart in Couchbase with Node JS and Express

:page-slug: tutorial-nextjs
:page-title: Using Next.js with Couchbase
:page-category: tutorials
:page-desc: Build a basic Next.js front-end and back-end app with Couchbase
:page-tags: Tutorial, Node.js
:page-order: 00004
:page-estimate: 60 min

[.title]
{page-title}

image::https://da-demo-images.s3.amazonaws.com/runItNow_outline.png?couchbase-example=nextjs-quickstart-repo&source=devPortal[link="https://gitpod.io/#https://github.com/couchbase-examples/tutorial-nextjs", width=150]

[.desc]
{page-desc}

[abstract]
In this article, you will learn how to use Next.js to connect to a Couchbase cluster to create, read, update, and delete documents and how to write simple parametrized N1QL queries. You will also build a basic front-end application to interact with your data.

We will be using the latest version of Couchbase (version 7) that enables scopes and collections.

== Prerequisites

To run this prebuilt project, you will need:

- Couchbase 7 Installed
- NodeJS & NPM (v12+)
- NextJS
- Code Editor

== What We'll Cover
Bootstrapping a new Next.js app using the 'with-couchbase' example, building out a simple REST API using the API framework built into Next.js and the, link:https://docs.couchbase.com/nodejs-sdk/current/hello-world/start-using-sdk.html[Node.js SDK for Couchbase], version 3.x with the following endpoints:

- <<post-profile>> – Create a new user profile
- <<getbykey-profile>> – Get a specific profile
- <<put-profile>> – Update a profile
- <<delete-profile>> – Delete a profile
- <<get-profiles>> – Get all profiles matching First or Last Name

We'll also build out a basic front-end application with Next.js to interact with the endpoints mentioned above.

== Source Code
The completed source code from this tutorial can be cloned with the following command:
```sh
git clone https://github.com/couchbase-examples/tutorial-nextjs
```

== Set up and Run The Application
We'll start by bootstrapping a new Next.js project using the 'with-couchbase' example:

```sh
npx create-next-app --example with-couchbase with-couchbase-app

# or

yarn create next-app --example with-couchbase with-couchbase-app
```

Install required dependencies and run:
```sh
npm install
npm run dev

# or

yarn install
yarn dev
```


*After installation of Couchbase 7, and if it is running on localhost (http://127.0.0.1:8091) we can create a bucket named `user_profile` and a collection named `profile`. You can do this manually by accessing the Couchbase console.


If you've cloned the completed project running the following command will handle bucket and collection creation:

```sh
npm run init-db:local
```

To set local environment variables, copy the `env.local.example` file in this directory to `.env.local`:

```bash
cp .env.local.example .env.local
```

Set each variable on `.env.local`:

- `COUCHBASE_USERNAME` - The username of an authorized user on your Couchbase instance
- `COUCHBASE_PASSWORD` - The corresponding password for the user specified above
- `COUCHBASE_ENDPOINT` - The endpoint to connect to. Use `localhost` for a local instance of Couchbase, or Wide Area Network address for a cloud instance (formatted like`<xxxxx>.dp.cloud.couchbase.com`)
- `COUCHBASE_BUCKET` - The bucket you'd like to connect to. Set this to `user_profiles` for this tutorial.
- `IS_CLOUD_INSTANCE` - `true` if you are trying to connect to an instance of Couchbase Cloud, `false` otherwise.

In order to interact with your Couchbase instance, you'll need to set up and configure the database.


If everything is set up properly, you should be able to navigate to localhost:3000 to see a message confirming succesful connection to Couchbase. For troubleshooting and additional setup instructions please refer to the `NextJS_README.md` included in the with-couchbase starter.

Note: Gitpod and testing environments use the .env.default file to automatically set up a Couchbase instance with default credentials.

== Notes About the Quickstart Code
- We've included a `.env.default` file which is used for testing and gitpod instances of the project to ensure smooth setup in these environments.

- In the completed quickstart code, fetch URLs use a dynamic `origin` variable instead of hard coding `http://localhost:3000` to ensure requests work when running in other environments. We use link:https://www.npmjs.com/package/next-absolute-url[next-absolute-url] for this.

== Running The Tests
A suite of integration tests has been included, and can be run by first setting up the database:
```
npm run init-db:default
```
and then using the `npm test` command.
